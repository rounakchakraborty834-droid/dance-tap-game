<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dance Detection App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: #000;
      font-family: Arial, sans-serif;
    }
    #loading-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      z-index: 9999;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 20px auto;
      border: 5px solid white;
      box-shadow: 0 0 20px #ff00ff;
    }
    #tapButtons {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
    }
    .tapBtn {
      padding: 15px 25px;
      font-size: 18px;
      background-color: #ff00ff;
      color: white;
      border-radius: 50px;
      border: none;
    }
    #startBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #00ffff;
      color: black;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    #main-app {
      display: none;
      color: white;
      text-align: center;
      padding-top: 50px;
    }
  </style>
</head>
<body>

  <!-- ðŸŽ® Loading Screen with Tap Game -->
  <div id="loading-screen">
    <h1 style="color:white;">ðŸŽ¶ Loading Dance Engineâ€¦</h1>
    <button id="startBtn">Start Game</button>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <div id="tapButtons">
      <button class="tapBtn" onclick="tap(1)">A</button>
      <button class="tapBtn" onclick="tap(2)">S</button>
      <button class="tapBtn" onclick="tap(3)">D</button>
    </div>
    <audio id="bgMusic" src="assets/music.mp3"></audio>
  </div>

  <!-- ðŸ§  Main Dance Detection App -->
  <div id="main-app">
    <h2>Dance Detection Ready!</h2>
    <!-- Camera feed, detection UI etc -->
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const bgMusic = document.getElementById("bgMusic");

    const laneX = {
      1: canvas.width / 4 - 20,
      2: canvas.width / 2 - 20,
      3: (canvas.width * 3) / 4 - 20
    };

    const beatImages = {
      1: new Image(),
      2: new Image(),
      3: new Image()
    };
    beatImages[1].src = "assets/beat_red.png";
    beatImages[2].src = "assets/beat_yellow.png";
    beatImages[3].src = "assets/beat_blue.png";

    const tapZoneImg = new Image();
    tapZoneImg.src = "assets/tap_zone.png";

    const bgImg = new Image();
    bgImg.src = "assets/background.png";

    let beats = [];
    let score = 0;
    let combo = 0;
    let misses = 0;
    let gameStarted = false;
    let beatSpeed = 4;
    let beatInterval;
    let modelLoaded = false;

    function startGame() {
      score = 0;
      combo = 0;
      misses = 0;
      beats = [];
      gameStarted = true;

      bgMusic.play().then(() => {
        document.getElementById("startBtn").style.display = "none";
      }).catch((e) => {
        console.log("Autoplay blocked:", e);
      });

      beatInterval = setInterval(() => {
        const lane = Math.floor(Math.random() * 3) + 1;
        beats.push({
          lane,
          x: laneX[lane],
          y: -40,
          hit: false,
          img: beatImages[lane]
        });
      }, 700);
    }

    function endGame() {
      gameStarted = false;
      clearInterval(beatInterval);
      bgMusic.pause();
    }

    function tap(lane) {
      let hit = false;
      beats.forEach((beat) => {
        if (!beat.hit && beat.lane === lane && beat.y > 400 && beat.y < 470) {
          beat.hit = true;
          score += 10;
          combo += 1;
          hit = true;
        }
      });
      if (!hit) {
        combo = 0;
        misses += 1;
      }
    }

    document.addEventListener("keydown", (e) => {
      if (!gameStarted) return;
      if (e.code === "KeyA") tap(1);
      if (e.code === "KeyS") tap(2);
      if (e.code === "KeyD") tap(3);
    });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

      for (let i = 1; i <= 3; i++) {
        ctx.drawImage(tapZoneImg, laneX[i] - 20, 440, 80, 60);
      }

      beats.forEach((beat) => {
        if (!beat.hit) {
          ctx.drawImage(beat.img, beat.x, beat.y, 40, 40);
          beat.y += beatSpeed;
          if (beat.y > 500) {
            beat.hit = true;
            combo = 0;
            misses += 1;
          }
        }
      });

      ctx.fillStyle = "#FFD700";
      ctx.font = "bold 20px Comic Sans MS";
      ctx.fillText("Score: " + score, 20, 30);
      ctx.fillText("Combo: " + combo, 20, 60);
      ctx.fillText("Misses: " + misses, 20, 90);
    }

    function update() {
      if (gameStarted) draw();
      requestAnimationFrame(update);
    }

    update();

    async function loadDanceModel() {
      return new Promise(resolve => setTimeout(resolve, 60000)); // âœ… 1 minute loading
    }

    loadDanceModel().then(() => {
      modelLoaded = true;
      document.getElementById("loading-screen").style.display = "none";
      document.getElementById("main-app").style.display = "block";
      endGame();
    });

    document.getElementById("startBtn").addEventListener("click", () => {
      startGame();
    });
  </script>

</body>
</html>